
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Taller 2. Visualización de Datos en Python y R. &#8212; Maestría en Estadística Aplicada</title>
    
  <link href="_static/css/theme.css" rel="stylesheet">
  <link href="_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script>
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Análisis Exploratorio de Datos - Proyecto Final Python" href="EDA_Acciones_COL.html" />
    <link rel="prev" title="Taller 1. Visualización de Datos en Python y R." href="Taller1_Python_JA_AP.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="_static/1200px-Logo_uninorte_colombia.jpg" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Maestría en Estadística Aplicada</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="intro.html">
   Proyecto Final Python - Curso de Visualización en Python y R
  </a>
 </li>
</ul>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="Taller1_Python_JA_AP.html">
   Taller 1. Introducción a la visualización de datos con Python.
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Taller 2. Visualización interactiva de datos.
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="EDA_Acciones_COL.html">
   Análisis de las series temporales relacionadas con las cinco acciones principales colombianas en la bolsa de Nueva York.
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/Taller2_Python_JA_AP.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/executablebooks/jupyter-book"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2FTaller2_Python_JA_AP.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/executablebooks/jupyter-book/master?urlpath=tree/docs/Taller2_Python_JA_AP.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#jorge-arteaga-y-adriana-palacio">
   Jorge Arteaga y Adriana Palacio.
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#maestria-en-estadistica-aplicada">
   Maestría en Estadística Aplicada.
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#universidad-del-norte">
     Universidad del Norte.
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#ejercicio-2-1">
   Ejercicio 2.1
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#ejercicio-2-2">
   Ejercicio 2.2
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#ejercicio-2-3">
   Ejercicio 2.3
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#ejercicio-2-4">
   Ejercicio 2.4
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="taller-2-visualizacion-de-datos-en-python-y-r">
<h1>Taller 2. Visualización de Datos en Python y R.<a class="headerlink" href="#taller-2-visualizacion-de-datos-en-python-y-r" title="Permalink to this headline">¶</a></h1>
<div class="section" id="jorge-arteaga-y-adriana-palacio">
<h2>Jorge Arteaga y Adriana Palacio.<a class="headerlink" href="#jorge-arteaga-y-adriana-palacio" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="maestria-en-estadistica-aplicada">
<h2>Maestría en Estadística Aplicada.<a class="headerlink" href="#maestria-en-estadistica-aplicada" title="Permalink to this headline">¶</a></h2>
<div class="section" id="universidad-del-norte">
<h3>Universidad del Norte.<a class="headerlink" href="#universidad-del-norte" title="Permalink to this headline">¶</a></h3>
</div>
</div>
<div class="section" id="ejercicio-2-1">
<h2>Ejercicio 2.1<a class="headerlink" href="#ejercicio-2-1" title="Permalink to this headline">¶</a></h2>
<p>Trabajaremos con los conjuntos de datos <strong>Renewable Energy Consumption and Production</strong> de Our World in Data (<a class="reference external" href="https://ourworldindata.org/renewable-energy">https://ourworldindata.org/renewable-energy</a>). Estos conjuntos de datos están disponibles en el repositorio <strong>GitHub</strong> del curso, púedes ser importados con las <strong>URL</strong>: <a class="reference external" href="https://raw.githubusercontent.com/lihkir/Uninorte/main/AppliedStatisticMS/DataVisualizationRPython/Lectures/Python/PythonDataSets/share-of-electricity-production-from-renewable-sources.csv">share-of-electricity-production-from-renewable-sources.csv</a>, <a class="reference external" href="https://raw.githubusercontent.com/lihkir/Uninorte/main/AppliedStatisticMS/DataVisualizationRPython/Lectures/Python/PythonDataSets/renewable-energy-consumption-by-country.csv">renewable-energy-consumption-by-country.csv</a></p>
<p>Su tarea consiste en crear mapas coropléticos de la producción y el consumo totales de energía renovable y el consumo en diferentes países del mundo animados en base a los años de años de producción/consumo entre (excluyendo) 2007 y 2017.</p>
<ul class="simple">
<li><p><strong>Pasos principales</strong></p>
<ol class="simple">
<li><p>Cargar el conjunto de datos de producción de energía renovable.</p></li>
<li><p>Ordenar el <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> de producción en función de la característica <em>Year</em>.</p></li>
<li><p>Generar un mapa de coropletas para la producción de energía renovable utilizando el módulo <code class="docutils literal notranslate"><span class="pre">plotly</span> <span class="pre">express</span></code> animado en función del <em>Year</em>.</p></li>
<li><p>Actualice el diseño para incluir un estilo de proyección adecuado y un texto de título, y luego muestre la figura.</p></li>
<li><p>Cargue el conjunto de datos de consumo de energía renovable.</p></li>
<li><p>Convierta el <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> de consumo a un formato adecuado para su visualización.</p></li>
<li><p>Ordenar el <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> de consumo en base a la característica <em>Year</em>.</p></li>
<li><p>Generar un mapa coroplético para el consumo de energía renovable utilizando el módulo <code class="docutils literal notranslate"><span class="pre">plotly</span> <span class="pre">express</span></code> animado en función del año.</p></li>
<li><p>Actualice el diseño para incluir un estilo de proyección adecuado y un texto de título, y luego muestre la figura.</p></li>
</ol>
</li>
</ul>
<p>Primero, cargaremos los modulos que se usarán en todo el taller:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span>  <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">mktime</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">plotly.express</span> <span class="k">as</span> <span class="nn">px</span>
<span class="kn">from</span> <span class="nn">plotly.offline</span> <span class="kn">import</span> <span class="n">plot</span> <span class="k">as</span> <span class="n">px_off_plot</span>
<span class="kn">import</span> <span class="nn">plotly.graph_objects</span> <span class="k">as</span> <span class="nn">go</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">from</span> <span class="nn">urllib.request</span> <span class="kn">import</span> <span class="n">urlopen</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">IFrame</span><span class="p">,</span> <span class="n">display</span><span class="p">,</span> <span class="n">HTML</span>

<span class="kn">from</span> <span class="nn">statsmodels.tsa.stattools</span> <span class="kn">import</span> <span class="n">adfuller</span>
<span class="kn">from</span> <span class="nn">statsmodels.graphics.tsaplots</span> <span class="kn">import</span> <span class="n">plot_acf</span>
<span class="kn">from</span> <span class="nn">statsmodels.tsa.arima.model</span> <span class="kn">import</span> <span class="n">ARIMA</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">log</span>

<span class="kn">import</span> <span class="nn">psycopg2</span>
<span class="kn">from</span> <span class="nn">psycopg2</span> <span class="kn">import</span> <span class="n">Error</span>
<span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">create_engine</span>

<span class="kn">import</span> <span class="nn">finnhub</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ModuleNotFoundError</span><span class="g g-Whitespace">                       </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="n">w2</span><span class="o">/</span><span class="n">j_r2nxj526x02wjfw52mqty1h_5b0_</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_88394</span><span class="o">/</span><span class="mf">4177668717.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="g g-Whitespace">     </span><span class="mi">22</span> <span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">create_engine</span>
<span class="g g-Whitespace">     </span><span class="mi">23</span> 
<span class="ne">---&gt; </span><span class="mi">24</span> <span class="kn">import</span> <span class="nn">finnhub</span>
<span class="g g-Whitespace">     </span><span class="mi">25</span> <span class="kn">import</span> <span class="nn">warnings</span>
<span class="g g-Whitespace">     </span><span class="mi">26</span> <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>

<span class="ne">ModuleNotFoundError</span>: No module named &#39;finnhub&#39;
</pre></div>
</div>
</div>
</div>
<p>Primero, leamos los archivos de la <strong>URL</strong>, y carguemoslos en un <strong>DataFrame</strong> de <strong>pandas</strong>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">energy_prod_url</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/lihkir/Uninorte/main/AppliedStatisticMS/DataVisualizationRPython/Lectures/Python/PythonDataSets/share-of-electricity-production-from-renewable-sources.csv&quot;</span>
<span class="n">prod_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">energy_prod_url</span><span class="p">)</span>
<span class="n">prod_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Country</th>
      <th>Code</th>
      <th>Year</th>
      <th>Renewable electricity (% electricity production)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Afghanistan</td>
      <td>AFG</td>
      <td>1990</td>
      <td>67.730496</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Afghanistan</td>
      <td>AFG</td>
      <td>1991</td>
      <td>67.980296</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Afghanistan</td>
      <td>AFG</td>
      <td>1992</td>
      <td>67.994310</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Afghanistan</td>
      <td>AFG</td>
      <td>1993</td>
      <td>68.345324</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Afghanistan</td>
      <td>AFG</td>
      <td>1994</td>
      <td>68.704512</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">energy_cons_url</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/lihkir/Uninorte/main/AppliedStatisticMS/DataVisualizationRPython/Lectures/Python/PythonDataSets/renewable-energy-consumption-by-country.csv&quot;</span>
<span class="n">comsup_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">energy_cons_url</span><span class="p">)</span>
<span class="n">comsup_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Country</th>
      <th>Code</th>
      <th>Year</th>
      <th>Traditional biofuels</th>
      <th>Other renewables (modern biofuels, geothermal, wave &amp; tidal)</th>
      <th>Wind</th>
      <th>Solar PV</th>
      <th>Hydropower</th>
      <th>Total</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Algeria</td>
      <td>DZA</td>
      <td>1965</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Algeria</td>
      <td>DZA</td>
      <td>1966</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Algeria</td>
      <td>DZA</td>
      <td>1967</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Algeria</td>
      <td>DZA</td>
      <td>1968</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Algeria</td>
      <td>DZA</td>
      <td>1969</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Primero, revisemos si el dataframe de producción de energía renovable tiene valores faltantes.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">prod_df</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">/</span><span class="n">prod_df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="mi">100</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Country                                             0.000000
Code                                                5.548363
Year                                                0.000000
Renewable electricity (% electricity production)    0.000000
dtype: float64
</pre></div>
</div>
</div>
</div>
<p>Como se puede observar, solo la columna de <code class="docutils literal notranslate"><span class="pre">Code</span></code> tiene valores faltantes, con el 5.54% de valores faltantes. Si bien, lo ideal sería imputar estos datos, para el ejercicio que realiceramos no afectará los cálculos o nivel de producción. Esto nos afectará solamente en la presentación del código, por lo cual, por lo pronto, dejaremos el dataframe así.</p>
<p>Ordenemos ahora el dataframe relacionado con la producción de energía renovable en función del año.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">prod_df</span> <span class="o">=</span> <span class="n">prod_df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;Year&quot;</span><span class="p">,</span><span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">prod_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Country</th>
      <th>Code</th>
      <th>Year</th>
      <th>Renewable electricity (% electricity production)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Afghanistan</td>
      <td>AFG</td>
      <td>1990</td>
      <td>67.730496</td>
    </tr>
    <tr>
      <th>1668</th>
      <td>France</td>
      <td>FRA</td>
      <td>1990</td>
      <td>13.369879</td>
    </tr>
    <tr>
      <th>1643</th>
      <td>Finland</td>
      <td>FIN</td>
      <td>1990</td>
      <td>29.451790</td>
    </tr>
    <tr>
      <th>1618</th>
      <td>Fiji</td>
      <td>FJI</td>
      <td>1990</td>
      <td>82.441113</td>
    </tr>
    <tr>
      <th>1593</th>
      <td>Faeroe Islands</td>
      <td>FRO</td>
      <td>1990</td>
      <td>35.545024</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Generemos un mapa de cloropletas para la producción de energía renovable utilizando el módulo de <code class="docutils literal notranslate"><span class="pre">plotly</span> <span class="pre">express</span></code>, con un slider para mostrar el cambio a través de los años de manera dinámica:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">choropleth</span><span class="p">(</span><span class="n">prod_df</span><span class="p">,</span> <span class="n">locations</span><span class="o">=</span><span class="s2">&quot;Code&quot;</span><span class="p">,</span> <span class="c1"># colunm containing ISO 3166 country codes</span>
                    <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;Renewable electricity (</span><span class="si">% e</span><span class="s2">lectricity production)&quot;</span><span class="p">,</span> <span class="c1"># column by which to color-code</span>
                    <span class="n">hover_name</span> <span class="o">=</span> <span class="s2">&quot;Country&quot;</span><span class="p">,</span> <span class="c1"># column to display in hover information</span>
                    <span class="n">color_continuous_scale</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">sequential</span><span class="o">.</span><span class="n">Plasma</span><span class="p">,</span>
                    <span class="n">animation_frame</span><span class="o">=</span><span class="s2">&quot;Year&quot;</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
    <span class="c1"># add a title text for the plot</span>
    <span class="n">title_text</span> <span class="o">=</span> <span class="s1">&#39;Reneweable energy production per Country (</span><span class="si">% E</span><span class="s1">lectricity Prod)&#39;</span><span class="p">,</span>
    <span class="c1"># set projection style for the plot</span>
    <span class="n">geo</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="s1">&#39;natural earth&#39;</span><span class="p">})</span> <span class="c1"># by default, projection type is set to &#39;equirectangular&#39;</span>
<span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">renderer</span><span class="o">=</span><span class="s2">&quot;svg&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">900</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">410</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/Taller2_Python_JA_AP_12_0.svg" src="_images/Taller2_Python_JA_AP_12_0.svg" /></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Para generar la visualización a tráves de los años</span>
<span class="n">px_off_plot</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;temp-plot.html&#39;
</pre></div>
</div>
</div>
</div>
<p>Como se puede observar en la figura, en el año 1990, los países que producen más energía renovable son mayoritariamente de Latinoamérica y África, entre ellos, Paraguay, Costa Rica, Honduras, Brasil, ambos Congos, Zambia, Camerún, entre otros. En Europa, los países con más producción son Noruega e Islandia. Se puede observar que los países que tienen menos producción de energía renovable están ubicados en Asia-Pacífico, Europa, el Norte de África y Estados Unidos.</p>
<p>En 2014, se observa que las regiones que producían más energía renovable han bajado considerablemente su producción de energía renovable, siguen liderando a nivel mundial la producción (África central y Latinoamérica). De los países que siguen con un porcentaje del 99% de producción, Paraguay, República Democrática del Congo y Zambia siguen liderando.</p>
<p>En Europa, se nota un aumento en la producción de energía renovable, siendo Noruega e Islandia los países que siguen teniendo la mayor producción de energía renovable. Las regiones con menor producción de energía renovable siguen siendo las mismas que hace 14 años, Asia-Pacífico, el Norte de África y Estados Unidos.</p>
<p>Miremos ahora el dataframe relacionado con el consumo de energía renovable en el mundo. Para esto, primero lo transformaremos. Primero imputaremos los valores faltantes.</p>
<p>Como estamos hablando de consumo de energía, asumiremos que el hecho de que no haya información sobre una energía renovable específica, implica que no hay capacidad de generación de dicha energía en el país, por lo que podríamos reemplazar estos valores por cero sin ningún problema.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Primero revisando las columnas que tienen valores faltantes</span>
<span class="p">(</span><span class="n">comsup_df</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">/</span><span class="n">comsup_df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="mi">100</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Country                                                           0.0
Code                                                              0.0
Year                                                              0.0
Traditional biofuels                                            100.0
Other renewables (modern biofuels, geothermal, wave &amp; tidal)      0.0
Wind                                                              0.0
Solar PV                                                          0.0
Hydropower                                                      100.0
Total                                                             0.0
dtype: float64
</pre></div>
</div>
</div>
</div>
<p>Como se observa, las columnas de <code class="docutils literal notranslate"><span class="pre">Traditional</span> <span class="pre">Biofuels</span></code> y <code class="docutils literal notranslate"><span class="pre">Hydropower</span></code> tienen el 100% de valores faltantes. Estas columnas no nos están aportando ninguna información relevante, por lo cual las borraremos.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">comsup_df</span> <span class="o">=</span> <span class="n">comsup_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Traditional biofuels&quot;</span><span class="p">,</span> <span class="s2">&quot;Hydropower&quot;</span><span class="p">])</span>
<span class="n">comsup_df</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Year</th>
      <th>Other renewables (modern biofuels, geothermal, wave &amp; tidal)</th>
      <th>Wind</th>
      <th>Solar PV</th>
      <th>Total</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>3344.000000</td>
      <td>3344.000000</td>
      <td>3344.000000</td>
      <td>3344.000000</td>
      <td>3344.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>1991.169856</td>
      <td>2.276702</td>
      <td>1.691107</td>
      <td>0.351261</td>
      <td>4.319069</td>
    </tr>
    <tr>
      <th>std</th>
      <td>14.905982</td>
      <td>7.898646</td>
      <td>11.395594</td>
      <td>2.885864</td>
      <td>19.741046</td>
    </tr>
    <tr>
      <th>min</th>
      <td>1965.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>1978.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>1992.000000</td>
      <td>0.024500</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.057000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>2004.000000</td>
      <td>1.188779</td>
      <td>0.012000</td>
      <td>0.000832</td>
      <td>1.558361</td>
    </tr>
    <tr>
      <th>max</th>
      <td>2016.000000</td>
      <td>84.606506</td>
      <td>241.000000</td>
      <td>66.200000</td>
      <td>380.607427</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Como se puede observar, contamos con cinco columnas. Una que representa el año, tres que representan distintos tipos de energía renovable, y la última columna que nos indica el total de consumo de energía renovable. Para el gráfico que realizaremos, usaremos en primera instancia el total de consumo de energía renovable.</p>
<p>Primero organicemos el dataframe por año.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">comsup_df</span> <span class="o">=</span> <span class="n">comsup_df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;Year&quot;</span><span class="p">,</span><span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">comsup_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Country</th>
      <th>Code</th>
      <th>Year</th>
      <th>Other renewables (modern biofuels, geothermal, wave &amp; tidal)</th>
      <th>Wind</th>
      <th>Solar PV</th>
      <th>Total</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Algeria</td>
      <td>DZA</td>
      <td>1965</td>
      <td>0.000</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.000</td>
    </tr>
    <tr>
      <th>1364</th>
      <td>Ireland</td>
      <td>IRL</td>
      <td>1965</td>
      <td>0.000</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.000</td>
    </tr>
    <tr>
      <th>2656</th>
      <td>Sweden</td>
      <td>SWE</td>
      <td>1965</td>
      <td>0.000</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.000</td>
    </tr>
    <tr>
      <th>1416</th>
      <td>Israel</td>
      <td>ISR</td>
      <td>1965</td>
      <td>0.000</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.000</td>
    </tr>
    <tr>
      <th>1468</th>
      <td>Italy</td>
      <td>ITA</td>
      <td>1965</td>
      <td>2.676</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>2.676</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Prosigamos ahora con el gráfico para el consumo total de energía renovable por país a través de los años.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">choropleth</span><span class="p">(</span><span class="n">comsup_df</span><span class="p">,</span> <span class="n">locations</span><span class="o">=</span><span class="s2">&quot;Code&quot;</span><span class="p">,</span> <span class="c1"># colunm containing ISO 3166 country codes</span>
                    <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;Total&quot;</span><span class="p">,</span> <span class="c1"># column by which to color-code</span>
                    <span class="n">hover_name</span> <span class="o">=</span> <span class="s2">&quot;Country&quot;</span><span class="p">,</span> <span class="c1"># column to display in hover information</span>
                    <span class="n">color_continuous_scale</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">sequential</span><span class="o">.</span><span class="n">Plasma</span><span class="p">,</span>
                    <span class="n">animation_frame</span><span class="o">=</span><span class="s2">&quot;Year&quot;</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
    <span class="c1"># add a title text for the plot</span>
    <span class="n">title_text</span> <span class="o">=</span> <span class="s1">&#39;Reneweable energy comsuption per Country (TWh)&#39;</span><span class="p">,</span>
    <span class="c1"># set projection style for the plot</span>
    <span class="n">geo</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="s1">&#39;natural earth&#39;</span><span class="p">})</span> <span class="c1"># by default, projection type is set to &#39;equirectangular&#39;</span>
<span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">renderer</span><span class="o">=</span><span class="s2">&quot;svg&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">900</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">410</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/Taller2_Python_JA_AP_22_0.svg" src="_images/Taller2_Python_JA_AP_22_0.svg" /></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Para generar la visualización offline a tráves de los años</span>
<span class="n">px_off_plot</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;temp-plot.html&#39;
</pre></div>
</div>
</div>
</div>
<p>Como se puede observar en la animación, poco países consumían energía renovable en 1965, y la cantidad era muy pequeña. El país que más consumía renovables era Italia con 2.6TWh. Al pasar de los años, más países empiezan a consumir energía renovable, y la cantidad de la energía consumida aumenta considerablemente. En 2016, los países con más consumo de energía renovable son China, Estados Unidos, y Alemania, con 380TWh, 370TWh y 167TWh, respectivamente.</p>
</div>
<div class="section" id="ejercicio-2-2">
<h2>Ejercicio 2.2<a class="headerlink" href="#ejercicio-2-2" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Considere la serie de tiempo asociada con los futuros de la criptomoneda <strong>Bitcoin</strong> desde que comenzó a tradearse hasta la fecha del día de hoy. Utilice la <strong>API</strong> de <code class="docutils literal notranslate"><span class="pre">finnhub</span></code> para obtener esta serie de tiempo. Recuerde que para esto debe crear primero una cuenta, y así obtener su <strong>API Key</strong> para realizar la conexión de forma efectiva.</p></li>
<li><p>Repita <strong>TODOS</strong> los pasos indicados en esta sección para encontrar modelos <strong>ARIMA</strong> para predecir el precio de <strong>Bitcoin</strong> con los siguientes horizontes: <strong>7 días, 14 días, 21 días, 28 días</strong>. Utilizar siempre predicciones usando <em>rolling</em> con ventana de predicción continua de un día. Cualquier cantidad de pasos extra para enriqucer su anális predictivo serán aceptados siempre y cuando sean acordes con lo que indica la teoría de análisis de series de tiempo.</p></li>
<li><p>Realice una tabla de error utlizando las métricas: <code class="docutils literal notranslate"><span class="pre">MAPE,</span> <span class="pre">MAE,</span> <span class="pre">RMSE,</span> <span class="pre">MSE</span></code>.</p></li>
<li><p>Repita el análisis desarrollado en los pasos anteriores considerando ahora el criterio de <strong>inferencia Bayesiana (BIC)</strong> para encontrar el mejor modelo <strong>ARIMA</strong> y compare los errores con aquellos obtenidos con el criterio de <strong>Akaike</strong>.</p></li>
<li><p>Escriba en cada paso las conclusiones y análisis estadísticos asociados con los resultados obtenidos. Realice un test de normalidad para los residuales obtenidos para cada predicción, en cada caso agregue las correspondientes conclusiones estadísticas. Figuras y algoritmos que no estén acompañados de una conclusión, descripción y análisis estadístico, no serán tenidas en cuenta.</p></li>
</ul>
<p>Los modulos que vamos a usar fueron cargados al principio del taller, ahora solo cargaremos el tema de paper, para que las gráficas se vean mejor.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">set_theme</span><span class="p">()</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set_context</span><span class="p">(</span><span class="s2">&quot;paper&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Para conectarnos a la API de FinnHub a través de Python, debemos tener una cuenta creada para usar la API key de dicha cuenta. En la siguiente celda, creamos una instancia del cliente de FinnHub con nuestra API key.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">finnhub_client</span> <span class="o">=</span> <span class="n">finnhub</span><span class="o">.</span><span class="n">Client</span><span class="p">(</span><span class="n">api_key</span><span class="o">=</span><span class="s2">&quot;c5tpk32ad3i9n9aj0u3g&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>El símbolo que vamos a usar para extraer la información es <code class="docutils literal notranslate"><span class="pre">BINANCE:BTCUSDT</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">finnhub_client</span><span class="o">.</span><span class="n">symbol_lookup</span><span class="p">(</span><span class="s1">&#39;BINANCE:BTCUSDT&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;count&#39;: 1, &#39;result&#39;: [{&#39;description&#39;: &#39;Binance BTC/USDT&#39;, &#39;displaySymbol&#39;: &#39;BTC/USDT&#39;, &#39;symbol&#39;: &#39;BINANCE:BTCUSDT&#39;, &#39;type&#39;: &#39;Crypto&#39;}]}
</pre></div>
</div>
</div>
</div>
<p>Teniendo el cliente instanciado, y el código a utilizar, ahora extraeremos toda la información asociada al par <code class="docutils literal notranslate"><span class="pre">BTC:USDT</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Par BTCUSDT</span>
<span class="n">stock</span> <span class="o">=</span> <span class="s1">&#39;BINANCE:BTCUSDT&#39;</span>
<span class="n">resolution</span> <span class="o">=</span> <span class="s1">&#39;D&#39;</span>

<span class="c1">#Tiempo a extraer</span>
<span class="n">end_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
<span class="n">start_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="mi">2017</span><span class="p">,</span> <span class="n">month</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">day</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>

<span class="c1">#FinnHub maneja tiempo en Unix, por lo cual convertiremos el tiempo de datetime a unix, y llamaremos la función stock_candles</span>
<span class="n">end</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">end_date</span><span class="o">.</span><span class="n">timestamp</span><span class="p">())</span>
<span class="n">start</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">start_date</span><span class="o">.</span><span class="n">timestamp</span><span class="p">())</span>

<span class="n">BTC_res</span> <span class="o">=</span> <span class="n">finnhub_client</span><span class="o">.</span><span class="n">stock_candles</span><span class="p">(</span><span class="n">stock</span><span class="p">,</span> <span class="n">resolution</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>
<span class="n">BTC_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">BTC_res</span><span class="p">)</span>

<span class="n">BTC_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>c</th>
      <th>h</th>
      <th>l</th>
      <th>o</th>
      <th>s</th>
      <th>t</th>
      <th>v</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>4285.08</td>
      <td>4485.39</td>
      <td>4200.74</td>
      <td>4261.48</td>
      <td>ok</td>
      <td>1502928000</td>
      <td>795.150377</td>
    </tr>
    <tr>
      <th>1</th>
      <td>4108.37</td>
      <td>4371.52</td>
      <td>3938.77</td>
      <td>4285.08</td>
      <td>ok</td>
      <td>1503014400</td>
      <td>1199.888264</td>
    </tr>
    <tr>
      <th>2</th>
      <td>4139.98</td>
      <td>4184.69</td>
      <td>3850.00</td>
      <td>4108.37</td>
      <td>ok</td>
      <td>1503100800</td>
      <td>381.309763</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4086.29</td>
      <td>4211.08</td>
      <td>4032.62</td>
      <td>4120.98</td>
      <td>ok</td>
      <td>1503187200</td>
      <td>467.083022</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4016.00</td>
      <td>4119.62</td>
      <td>3911.79</td>
      <td>4069.13</td>
      <td>ok</td>
      <td>1503273600</td>
      <td>691.743060</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">BTC_df</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(500, 7)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Función utilizada para convertir t a un formato legible</span>
<span class="k">def</span> <span class="nf">date_format</span><span class="p">(</span><span class="n">date_col</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">date_col</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">date_format</span><span class="p">(</span><span class="n">BTC_df</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;2018-12-28&#39;
</pre></div>
</div>
</div>
</div>
<p>Como se puede observar, incluso aunque coloquemos las fechas correctamente, FinnHub tiene una restricción sobre el número de columnas que nos puede dar por consulta, de 500. Lo que haremos entonces es hacer múltiples consultas para completar toda la historia transaccional del BTC.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Cambiando la fecha inicial</span>
<span class="n">start_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="mi">2018</span><span class="p">,</span> <span class="n">month</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">day</span><span class="o">=</span><span class="mi">29</span><span class="p">)</span>
<span class="n">start</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">start_date</span><span class="o">.</span><span class="n">timestamp</span><span class="p">())</span>

<span class="n">BTC_res</span> <span class="o">=</span> <span class="n">finnhub_client</span><span class="o">.</span><span class="n">stock_candles</span><span class="p">(</span><span class="n">stock</span><span class="p">,</span> <span class="n">resolution</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>
<span class="n">BTC_df2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">BTC_res</span><span class="p">)</span>

<span class="n">date_format</span><span class="p">(</span><span class="n">BTC_df2</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;2020-05-11&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Cambiando la fecha inicial</span>
<span class="n">start_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="mi">2020</span><span class="p">,</span> <span class="n">month</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">day</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">start</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">start_date</span><span class="o">.</span><span class="n">timestamp</span><span class="p">())</span>

<span class="n">BTC_res</span> <span class="o">=</span> <span class="n">finnhub_client</span><span class="o">.</span><span class="n">stock_candles</span><span class="p">(</span><span class="n">stock</span><span class="p">,</span> <span class="n">resolution</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>
<span class="n">BTC_df3</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">BTC_res</span><span class="p">)</span>

<span class="n">date_format</span><span class="p">(</span><span class="n">BTC_df3</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;2021-09-23&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Cambiando la fecha inicial</span>
<span class="n">start_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="mi">2021</span><span class="p">,</span> <span class="n">month</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="n">day</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span>
<span class="n">start</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">start_date</span><span class="o">.</span><span class="n">timestamp</span><span class="p">())</span>

<span class="n">BTC_res</span> <span class="o">=</span> <span class="n">finnhub_client</span><span class="o">.</span><span class="n">stock_candles</span><span class="p">(</span><span class="n">stock</span><span class="p">,</span> <span class="n">resolution</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>
<span class="n">BTC_df4</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">BTC_res</span><span class="p">)</span>

<span class="n">date_format</span><span class="p">(</span><span class="n">BTC_df4</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;2021-11-28&#39;
</pre></div>
</div>
</div>
</div>
<p>Ahora procedemos a unir todos los dataframes en uno solo con toda la información:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">BTC_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">BTC_df</span><span class="p">,</span> <span class="n">BTC_df2</span><span class="p">,</span> <span class="n">BTC_df3</span><span class="p">,</span> <span class="n">BTC_df4</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">BTC_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>c</th>
      <th>h</th>
      <th>l</th>
      <th>o</th>
      <th>s</th>
      <th>t</th>
      <th>v</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>4285.08</td>
      <td>4485.39</td>
      <td>4200.74</td>
      <td>4261.48</td>
      <td>ok</td>
      <td>1502928000</td>
      <td>795.150377</td>
    </tr>
    <tr>
      <th>1</th>
      <td>4108.37</td>
      <td>4371.52</td>
      <td>3938.77</td>
      <td>4285.08</td>
      <td>ok</td>
      <td>1503014400</td>
      <td>1199.888264</td>
    </tr>
    <tr>
      <th>2</th>
      <td>4139.98</td>
      <td>4184.69</td>
      <td>3850.00</td>
      <td>4108.37</td>
      <td>ok</td>
      <td>1503100800</td>
      <td>381.309763</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4086.29</td>
      <td>4211.08</td>
      <td>4032.62</td>
      <td>4120.98</td>
      <td>ok</td>
      <td>1503187200</td>
      <td>467.083022</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4016.00</td>
      <td>4119.62</td>
      <td>3911.79</td>
      <td>4069.13</td>
      <td>ok</td>
      <td>1503273600</td>
      <td>691.743060</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">date_format</span><span class="p">(</span><span class="n">BTC_df</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;2017-08-16&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">date_format</span><span class="p">(</span><span class="n">BTC_df</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;2021-11-28&#39;
</pre></div>
</div>
</div>
</div>
<p>Una vez completada la extracción de los datos, cambiemos los nombres de las columnas, eliminemos la columna <code class="docutils literal notranslate"><span class="pre">s</span></code> que no nos aportará nada al modelo, y cambiemos también el formato del tiempo.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Cambiando el formato del tiempo</span>
<span class="n">BTC_df</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">BTC_df</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">date_format</span><span class="p">)</span>

<span class="c1">#Cambiando los nombres de las columnas, y eliminando la columna s</span>
<span class="n">BTC_df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;c&#39;</span><span class="p">:</span><span class="s1">&#39;Close&#39;</span><span class="p">,</span><span class="s1">&#39;h&#39;</span><span class="p">:</span><span class="s1">&#39;High&#39;</span><span class="p">,</span><span class="s1">&#39;l&#39;</span><span class="p">:</span><span class="s1">&#39;Low&#39;</span><span class="p">,</span><span class="s1">&#39;o&#39;</span><span class="p">:</span><span class="s1">&#39;Open&#39;</span><span class="p">,</span><span class="s1">&#39;t&#39;</span><span class="p">:</span><span class="s1">&#39;Date&#39;</span><span class="p">,</span><span class="s1">&#39;v&#39;</span><span class="p">:</span><span class="s1">&#39;Volume&#39;</span><span class="p">},</span> <span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">BTC_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">BTC_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Close</th>
      <th>High</th>
      <th>Low</th>
      <th>Open</th>
      <th>Date</th>
      <th>Volume</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>4285.08</td>
      <td>4485.39</td>
      <td>4200.74</td>
      <td>4261.48</td>
      <td>2017-08-16</td>
      <td>795.150377</td>
    </tr>
    <tr>
      <th>1</th>
      <td>4108.37</td>
      <td>4371.52</td>
      <td>3938.77</td>
      <td>4285.08</td>
      <td>2017-08-17</td>
      <td>1199.888264</td>
    </tr>
    <tr>
      <th>2</th>
      <td>4139.98</td>
      <td>4184.69</td>
      <td>3850.00</td>
      <td>4108.37</td>
      <td>2017-08-18</td>
      <td>381.309763</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4086.29</td>
      <td>4211.08</td>
      <td>4032.62</td>
      <td>4120.98</td>
      <td>2017-08-19</td>
      <td>467.083022</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4016.00</td>
      <td>4119.62</td>
      <td>3911.79</td>
      <td>4069.13</td>
      <td>2017-08-20</td>
      <td>691.743060</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Demosle un vistazo a la historia del BTC, y grafiquemos la serie temporal:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">7</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">BTC_df</span><span class="o">.</span><span class="n">Date</span><span class="p">,</span> <span class="n">BTC_df</span><span class="o">.</span><span class="n">Close</span><span class="p">)</span>
<span class="n">freq</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">40</span><span class="p">)</span>
<span class="n">xtix</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xticks</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">xtix</span><span class="p">[::</span><span class="n">freq</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">50</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/Taller2_Python_JA_AP_48_0.png" src="_images/Taller2_Python_JA_AP_48_0.png" />
</div>
</div>
<p>Se puede observar que desde que se empezó a tranzar, el precio de Bitcoin empezó alrededor de los USD$5.000 y tuvó una tendencia alcista hasta casi que alcanzar los USD$20.000 en diciembre de 2017. Luego de esto, tuvo una fuerte caída y volvió a los mismos niveles. Desde 2018, estuvo por debajo de los USD$10.000, hasta mediados de 2019 donde supero levemente esa barrera. Luego de superarla, tuvo unas cuantas subidas y bajadas, pero el precio se mantenía alrededor de este valor, hasta finales de 2020, donde tuvo un crecimiento rápido, hasta alcanzar los USD$62.000 aproximadamente, en Marzo de 2021. Luego de eso, tuvo una corrección, pero volvió a subir para alcanzar su máximo histórico situado en torno a los USD$68.000 en Octubre de 2021. Actualmente, presenta una tendencia bajista, y se sitúa en torno a los USD$53.000.</p>
<p>Para continuar, antes de iniciar los modelos, realicemos una prueba estadística para verificar si la serie temporal asociada al par BTC:USDT es estacionaria o no. La prueba que usaremos es la de <code class="docutils literal notranslate"><span class="pre">Dickey-Fuller</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">result</span> <span class="o">=</span> <span class="n">adfuller</span><span class="p">(</span><span class="n">BTC_df</span><span class="o">.</span><span class="n">Close</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ADF Statistic: </span><span class="si">%f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;p-value: </span><span class="si">%f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">result</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ADF Statistic: 0.212658
p-value: 0.972963
</pre></div>
</div>
</div>
</div>
<p>Como se puede observar, con un nivel de significancia del 5%, el P-valor es mayor que el alpha, por lo cual, la hipótesis nula no se rechaza. Esto significa que no hay evidencia suficiente para afirmar que la serie temporal es estacionaria. Miremos ahora las figuras de autocorrelación, para verificar cuál es el orden de integración necesario para llevar nuestra serie de tiempo no estacionaria a una estacionaria.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;figure.figsize&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">15</span><span class="p">)})</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">BTC_df</span><span class="o">.</span><span class="n">Close</span><span class="p">);</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Original Series&#39;</span><span class="p">)</span>
<span class="n">plot_acf</span><span class="p">(</span><span class="n">BTC_df</span><span class="o">.</span><span class="n">Close</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">lags</span> <span class="o">=</span> <span class="mi">1500</span><span class="p">);</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">BTC_df</span><span class="o">.</span><span class="n">Close</span><span class="o">.</span><span class="n">diff</span><span class="p">());</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;1st Order Differencing&#39;</span><span class="p">)</span>
<span class="n">plot_acf</span><span class="p">(</span><span class="n">BTC_df</span><span class="o">.</span><span class="n">Close</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span><span class="o">.</span><span class="n">dropna</span><span class="p">(),</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">lags</span> <span class="o">=</span> <span class="mi">1500</span><span class="p">);</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">BTC_df</span><span class="o">.</span><span class="n">Close</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span><span class="o">.</span><span class="n">diff</span><span class="p">());</span> <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;2nd Order Differencing&#39;</span><span class="p">)</span>
<span class="n">plot_acf</span><span class="p">(</span><span class="n">BTC_df</span><span class="o">.</span><span class="n">Close</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span><span class="o">.</span><span class="n">dropna</span><span class="p">(),</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">lags</span> <span class="o">=</span> <span class="mi">1500</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/Taller2_Python_JA_AP_53_0.png" src="_images/Taller2_Python_JA_AP_53_0.png" />
</div>
</div>
<p>Se puede notar el decaimiento geométrico en la primera figura de autocorrelación (la serie original), que baja desde la parte positiva con una tendencia lineal. Esto también nos muestra y nos confirma la prueba de <code class="docutils literal notranslate"><span class="pre">Dickey-Fuller</span></code>, que la serie no es estacionaria. También se puede ver en el segundo gráfico de autocorrelación, correspondiente a la segunda derivada, que el retardo entra rápidamente en la zona negativa del gráfico, por lo cual nos indica que la serie fue sobrediferenciada.</p>
<p>Prosigamos ahora si con los modelos <strong>ARIMA</strong> para predecir el precio del <strong>Bitcoin</strong>. Como usaremos varios horizontes, crearemos una función general, que calcule el mejor modelo, y tendremos como entrada el horizonte.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Definiendo la función para entrenar los modelos ARIMA</span>
<span class="k">def</span> <span class="nf">ARIMA_model</span><span class="p">(</span><span class="n">horizon</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="s2">&quot;aic&quot;</span><span class="p">,</span> <span class="n">pq_rng</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="n">d_rng</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)):</span>
    <span class="c1">#Metric indicará la métrica a utilizar, aic o bic.</span>
    <span class="c1">#Calculando train y test size</span>
    <span class="n">n_BTC</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">BTC_df</span><span class="o">.</span><span class="n">Close</span><span class="p">);</span> <span class="n">n_test</span> <span class="o">=</span> <span class="n">horizon</span> <span class="c1"># This can be changed</span>
    <span class="n">train_size</span> <span class="o">=</span> <span class="n">n_BTC</span> <span class="o">-</span> <span class="n">n_test</span>

    <span class="c1">#Creando cada dataframe para train y test</span>
    <span class="n">train</span> <span class="o">=</span> <span class="n">BTC_df</span><span class="o">.</span><span class="n">Close</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">train_size</span><span class="p">]</span>
    <span class="n">test</span> <span class="o">=</span> <span class="n">BTC_df</span><span class="o">.</span><span class="n">Close</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_size</span><span class="p">:</span><span class="n">train_size</span> <span class="o">+</span> <span class="n">n_test</span><span class="p">]</span> 
    <span class="n">dates_test</span> <span class="o">=</span> <span class="n">BTC_df</span><span class="o">.</span><span class="n">Date</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_size</span><span class="p">:</span><span class="n">train_size</span> <span class="o">+</span> <span class="n">n_test</span><span class="p">]</span> 

    <span class="c1">#Encontrando el mejor modelo usando la métrica seleccionada</span>
    <span class="n">best_metric</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
    <span class="n">best_order</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">best_mdl</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="c1">#exceptions = []</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">pq_rng</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">d_rng</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">pq_rng</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">tmp_mdl</span> <span class="o">=</span> <span class="n">ARIMA</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">j</span><span class="p">))</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;innovations_mle&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">metric</span><span class="o">==</span><span class="s2">&quot;bic&quot;</span><span class="p">:</span>
                        <span class="n">tmp_metric</span> <span class="o">=</span> <span class="n">tmp_mdl</span><span class="o">.</span><span class="n">bic</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">tmp_metric</span> <span class="o">=</span> <span class="n">tmp_mdl</span><span class="o">.</span><span class="n">aic</span>                
                    
                    <span class="k">if</span> <span class="n">tmp_metric</span> <span class="o">&lt;</span> <span class="n">best_metric</span><span class="p">:</span>
                        <span class="n">best_metric</span> <span class="o">=</span> <span class="n">tmp_metric</span>
                        <span class="n">best_order</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
                        <span class="n">best_mdl</span> <span class="o">=</span> <span class="n">tmp_mdl</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span> 
                    <span class="c1">#exceptions.append(e)</span>
                    <span class="k">continue</span>

    <span class="c1">#Regresando los valores que se encontraron, junto con el train y el test set</span>
    <span class="k">return</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">test</span><span class="p">,</span> <span class="n">dates_test</span><span class="p">,</span> <span class="n">best_mdl</span><span class="p">,</span> <span class="n">best_order</span><span class="p">,</span> <span class="n">best_metric</span><span class="p">)</span><span class="c1">#, exceptions)</span>
</pre></div>
</div>
</div>
</div>
<p>También usaremos la función mostrada en clase por el profesor, para calcular el error de predicción cometido en las predicciones, usando las métrica <code class="docutils literal notranslate"><span class="pre">MAPE,</span> <span class="pre">MAE,</span> <span class="pre">RMSE,</span> <span class="pre">MSE</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">forecast_accuracy</span><span class="p">(</span><span class="n">forecast</span><span class="p">,</span> <span class="n">actual</span><span class="p">,</span> <span class="n">str_name</span><span class="p">):</span>
    
    <span class="n">mape</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">forecast</span> <span class="o">-</span> <span class="n">actual</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">actual</span><span class="p">))</span> <span class="c1"># MAPE</span>
    <span class="n">mae</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">forecast</span> <span class="o">-</span> <span class="n">actual</span><span class="p">))</span>                 <span class="c1"># MAE</span>
    <span class="n">rmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">forecast</span> <span class="o">-</span> <span class="n">actual</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mf">.5</span>               <span class="c1"># RMSE</span>
    <span class="n">mse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">forecast</span> <span class="o">-</span> <span class="n">actual</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>                    <span class="c1"># MSE</span>
    
    <span class="n">df_acc</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;MAE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">mae</span><span class="p">],</span>
                           <span class="s1">&#39;MSE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">mse</span><span class="p">],</span>
                           <span class="s1">&#39;MAPE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">mape</span><span class="p">],</span>
                           <span class="s1">&#39;RMSE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">rmse</span><span class="p">]},</span>
                          <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="n">str_name</span><span class="p">])</span>
    
    <span class="k">return</span> <span class="n">df_acc</span>
</pre></div>
</div>
</div>
</div>
<p>Calculemos primero, los mejores modelos ARIMA, usando horizontes de 7, 14, 21 y 28 días, y usando el criterio de Akaike. Mantendremos constantes los rangos usados en clase para calcular el mejor orden.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">horizons</span> <span class="o">=</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">28</span><span class="p">]</span>

<span class="n">best_models</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">horizon</span> <span class="ow">in</span> <span class="n">horizons</span><span class="p">:</span>
    <span class="n">best_m</span> <span class="o">=</span> <span class="n">ARIMA_model</span><span class="p">(</span><span class="n">horizon</span><span class="o">=</span><span class="n">horizon</span><span class="p">)</span>
    <span class="n">best_models</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">best_m</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Revisemos para cada horizonte, cuál es el mejor modelo usando el criterio de Akaike:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">best_models</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;aic: </span><span class="si">{:6.5f}</span><span class="s1"> | order: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">model</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">model</span><span class="p">[</span><span class="mi">4</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>aic: 25767.01289 | order: (2, 2, 3)
aic: 25620.58990 | order: (3, 2, 3)
aic: 25502.48775 | order: (3, 2, 4)
aic: 25360.23757 | order: (3, 2, 4)
</pre></div>
</div>
</div>
</div>
<p>Con los mejores modelos según el criterio de Akaike, podemos usarlos para predecir los valores futuros usando rolling. Para esto, usaremos los modelos guardados en la variable <code class="docutils literal notranslate"><span class="pre">best_models</span></code>. Adicionalmente, usaremos también la función utilizada en clase, con unos pequeños cambios (Ya calculamos el modelo y lo entrenamos, así que solo haremos las predicciones).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">arima_rolling</span><span class="p">(</span><span class="n">history</span><span class="p">,</span> <span class="n">test</span><span class="p">,</span> <span class="n">model_fit</span><span class="p">):</span>
    
    <span class="n">predictions</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">test</span><span class="p">)):</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">model_fit</span><span class="o">.</span><span class="n">forecast</span><span class="p">()</span>
        <span class="n">yhat</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">predictions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">yhat</span><span class="p">)</span>
        <span class="n">obs</span> <span class="o">=</span> <span class="n">test</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
        <span class="n">history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>
        <span class="c1">#print(&#39;predicted=%f, expected=%f&#39; % (yhat, obs))</span>
        
    <span class="k">return</span> <span class="n">predictions</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Variable para guardar las predicciones de cada modelo</span>
<span class="n">predictions_list</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1">#for loop para recorrer los modelos y generar las predicciones</span>
<span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">best_models</span><span class="p">:</span>
    <span class="n">pred</span> <span class="o">=</span> <span class="n">arima_rolling</span><span class="p">(</span><span class="n">var</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">(),</span> <span class="n">var</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">(),</span> <span class="n">var</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
    <span class="n">predictions_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pred</span><span class="p">)</span>

<span class="c1">#Variable para guardar las métricas</span>
<span class="n">df_metricas</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

<span class="c1">#Usamos la función forecast_accuracy para calcular las métricas de cada modelo</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">pred</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">predictions_list</span><span class="p">):</span>
    <span class="n">df_temp</span> <span class="o">=</span> <span class="n">forecast_accuracy</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pred</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">best_models</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]),</span> <span class="s2">&quot;Model for </span><span class="si">{}</span><span class="s2"> days&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">7</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)))</span>
    <span class="n">df_metricas</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df_metricas</span><span class="p">,</span> <span class="n">df_temp</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">df_metricas</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>MAE</th>
      <th>MSE</th>
      <th>MAPE</th>
      <th>RMSE</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Model for 7 days</th>
      <td>1474.385232</td>
      <td>2.801567e+06</td>
      <td>0.026205</td>
      <td>1673.788289</td>
    </tr>
    <tr>
      <th>Model for 14 days</th>
      <td>6143.561772</td>
      <td>4.111766e+07</td>
      <td>0.107793</td>
      <td>6412.305721</td>
    </tr>
    <tr>
      <th>Model for 21 days</th>
      <td>7466.866058</td>
      <td>7.013807e+07</td>
      <td>0.128816</td>
      <td>8374.847676</td>
    </tr>
    <tr>
      <th>Model for 28 days</th>
      <td>3169.282008</td>
      <td>1.354826e+07</td>
      <td>0.052689</td>
      <td>3680.795519</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Como se puede observar, tenemos errores bastantes altos para los modelos. El error más bajo fue para el modelo de 7 días. Esto se debe a la naturaleza de la serie temporal que estamos analizando, ya que por su alta volatilidad, es díficil predecir precios a más tiempo. También, podríamos tratar de tunear mejor los modelos, al usar más parámetros, pero esto aumentaría considerablemente el tiempo de cómputo.</p>
<p>Ahora, calculemos la misma tabla y los mismos modelos, pero esta vez teniendo en cuenta el criterio de inferencia Bayesiana para la selección de los mejores modelos. De esta manera podremos comparar las métricas arrojadas por la selección de cada criterio:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">horizons</span> <span class="o">=</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">28</span><span class="p">]</span>

<span class="n">best_models_bic</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">horizon</span> <span class="ow">in</span> <span class="n">horizons</span><span class="p">:</span>
    <span class="n">best_m</span> <span class="o">=</span> <span class="n">ARIMA_model</span><span class="p">(</span><span class="n">horizon</span><span class="o">=</span><span class="n">horizon</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="s2">&quot;bic&quot;</span><span class="p">)</span>
    <span class="n">best_models_bic</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">best_m</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">best_models_bic</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;bic: </span><span class="si">{:6.5f}</span><span class="s1"> | order: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">model</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">model</span><span class="p">[</span><span class="mi">4</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>bic: 25799.11598 | order: (2, 2, 3)
bic: 25658.01197 | order: (3, 2, 3)
bic: 25545.21962 | order: (3, 2, 4)
bic: 25402.93307 | order: (3, 2, 4)
</pre></div>
</div>
</div>
</div>
<p>Si bien, con el criterio Bayesiano estamos obteniendo valores un poquito más altos que con el criterio de Akaike, a la final, con los dos criterios se obtiene el mismo orden para cada horizonte evaluado, por lo cual, las predicciones de ambos modelos serán las mismas, y de esta manera, sus errores también lo serán. Por esta razón, no calcularemos la tabla de las métricas para los modelos generados mediante el criterio de inferencia bayesiana, ya que obtuvimos modelos del mismo orden.</p>
<p>Por último, grafiquemos entonces los resultados de las predicciones:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">15</span><span class="p">))</span>

<span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">best_models</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="n">best_models</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Test&quot;</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span> 
<span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">best_models</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="n">predictions_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Forecast&quot;</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span> <span class="c1">#Modelo con horizonte de siete días</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Fecha&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Precio de Cierre&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Forecast BTC:USDT - 7 días&quot;</span><span class="p">)</span>

<span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">best_models</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="n">best_models</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Test&quot;</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span> 
<span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">best_models</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="n">predictions_list</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Forecast&quot;</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span> <span class="c1">#Modelo con horizonte de catorce días</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Fecha&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Precio de Cierre&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Forecast BTC:USDT - 14 días&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>

<span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">best_models</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="n">best_models</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Test&quot;</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span> 
<span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">best_models</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="n">predictions_list</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Forecast&quot;</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span> <span class="c1">#Modelo con horizonte de veintiun días</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Fecha&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Precio de Cierre&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Forecast BTC:USDT - 21 días&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>

<span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">best_models</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="n">best_models</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Test&quot;</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span> 
<span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">best_models</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="n">predictions_list</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Forecast&quot;</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span> <span class="c1">#Modelo con horizonte de veintiocho días</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Fecha&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Precio de Cierre&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Forecast BTC:USDT - 28 días&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/Taller2_Python_JA_AP_69_0.png" src="_images/Taller2_Python_JA_AP_69_0.png" />
</div>
</div>
<p>Como habíamos vaticinado al principio, las predicciones son muy malas. Para mejorarlas, necesitamos seguir iterando sobre los hiper-parámetros (en este caso, el orden del modelo), o probar con otros parámetros del modelo ARIMA, para ver si encontramos una combinación que funcione mejor.</p>
</div>
<div class="section" id="ejercicio-2-3">
<h2>Ejercicio 2.3<a class="headerlink" href="#ejercicio-2-3" title="Permalink to this headline">¶</a></h2>
<p>Determine las características que se visualizan en un gráfico de dispersión. Se le da el conjunto de datos co2.csv y se le pide que proporcione información sobre él, como por ejemplo, qué tipo de patrones existen, si hay tendencias entre las características, etc. Es necesario que su visualización final transmita información significativa. Para conseguirlo, va a crear visualizaciones para diferentes emparejamientos de características para entender están correlacionadas y, por lo tanto, vale la pena visualizarlas.</p>
<p><strong>Pasos principales</strong></p>
<ul class="simple">
<li><p>Importe las bibliotecas necesarias.</p></li>
<li><p>Vuelva a crear el <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>. Desde el <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> <code class="docutils literal notranslate"><span class="pre">gm</span></code> incluya las columnas <code class="docutils literal notranslate"><span class="pre">population</span></code>, <code class="docutils literal notranslate"><span class="pre">fertility</span></code>, y <code class="docutils literal notranslate"><span class="pre">life</span></code></p></li>
<li><p>Visualiza la relación entre el <code class="docutils literal notranslate"><span class="pre">co2</span></code> y <code class="docutils literal notranslate"><span class="pre">life</span></code> utilizando un gráfico de dispersión, con el nombre del país como información en la herramienta hover y el año como deslizador.</p></li>
<li><p>Comprueba la correlación entre <code class="docutils literal notranslate"><span class="pre">co2</span></code> y <code class="docutils literal notranslate"><span class="pre">life</span></code>.</p></li>
<li><p>Visualiza la relación entre <code class="docutils literal notranslate"><span class="pre">co2</span></code> y <code class="docutils literal notranslate"><span class="pre">fertility</span></code> mediante un gráfico de dispersión, con el nombre del país como información en la herramienta hover y el año como deslizador.</p></li>
<li><p>Comprueba la correlación entre <code class="docutils literal notranslate"><span class="pre">co2</span></code> y <code class="docutils literal notranslate"><span class="pre">fertility</span></code></p></li>
</ul>
<p>Cargamos el conjuto de datos co2.csv y gapminder.csv</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">url_co2</span> <span class="o">=</span> <span class="s1">&#39;https://raw.githubusercontent.com/lihkir/Uninorte/main/AppliedStatisticMS/DataVisualizationRPython/Lectures/Python/PythonDataSets/co2.csv&#39;</span>
<span class="n">co2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">url_co2</span><span class="p">)</span>
<span class="n">co2</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>country</th>
      <th>1800</th>
      <th>1801</th>
      <th>1802</th>
      <th>1803</th>
      <th>1804</th>
      <th>1805</th>
      <th>1806</th>
      <th>1807</th>
      <th>1808</th>
      <th>...</th>
      <th>2005</th>
      <th>2006</th>
      <th>2007</th>
      <th>2008</th>
      <th>2009</th>
      <th>2010</th>
      <th>2011</th>
      <th>2012</th>
      <th>2013</th>
      <th>2014</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Afghanistan</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>0.0529</td>
      <td>0.0637</td>
      <td>0.0854</td>
      <td>0.154</td>
      <td>0.242</td>
      <td>0.294</td>
      <td>0.412</td>
      <td>0.35</td>
      <td>0.316</td>
      <td>0.299</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Albania</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>1.3800</td>
      <td>1.2800</td>
      <td>1.3000</td>
      <td>1.460</td>
      <td>1.480</td>
      <td>1.560</td>
      <td>1.790</td>
      <td>1.68</td>
      <td>1.730</td>
      <td>1.960</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Algeria</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>3.2200</td>
      <td>2.9900</td>
      <td>3.1900</td>
      <td>3.160</td>
      <td>3.420</td>
      <td>3.300</td>
      <td>3.290</td>
      <td>3.46</td>
      <td>3.510</td>
      <td>3.720</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Andorra</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>7.3000</td>
      <td>6.7500</td>
      <td>6.5200</td>
      <td>6.430</td>
      <td>6.120</td>
      <td>6.120</td>
      <td>5.870</td>
      <td>5.92</td>
      <td>5.900</td>
      <td>5.830</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Angola</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>0.9800</td>
      <td>1.1000</td>
      <td>1.2000</td>
      <td>1.180</td>
      <td>1.230</td>
      <td>1.240</td>
      <td>1.250</td>
      <td>1.33</td>
      <td>1.250</td>
      <td>1.290</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 216 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">url_gm</span> <span class="o">=</span> <span class="s1">&#39;https://raw.githubusercontent.com/lihkir/Uninorte/main/AppliedStatisticMS/DataVisualizationRPython/Lectures/Python/PythonDataSets/gapminder.csv&#39;</span>
<span class="n">gm</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">url_gm</span><span class="p">)</span>
<span class="n">gm</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Country</th>
      <th>Year</th>
      <th>fertility</th>
      <th>life</th>
      <th>population</th>
      <th>child_mortality</th>
      <th>gdp</th>
      <th>region</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Afghanistan</td>
      <td>1964</td>
      <td>7.671</td>
      <td>33.639</td>
      <td>10474903.0</td>
      <td>339.7</td>
      <td>1182.0</td>
      <td>South Asia</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Afghanistan</td>
      <td>1965</td>
      <td>7.671</td>
      <td>34.152</td>
      <td>10697983.0</td>
      <td>334.1</td>
      <td>1182.0</td>
      <td>South Asia</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Afghanistan</td>
      <td>1966</td>
      <td>7.671</td>
      <td>34.662</td>
      <td>10927724.0</td>
      <td>328.7</td>
      <td>1168.0</td>
      <td>South Asia</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Afghanistan</td>
      <td>1967</td>
      <td>7.671</td>
      <td>35.170</td>
      <td>11163656.0</td>
      <td>323.3</td>
      <td>1173.0</td>
      <td>South Asia</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Afghanistan</td>
      <td>1968</td>
      <td>7.671</td>
      <td>35.674</td>
      <td>11411022.0</td>
      <td>318.1</td>
      <td>1187.0</td>
      <td>South Asia</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>La información de los dos dataframes anteriores, los unificaremos dejando solo las columnas de interés:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_gm</span> <span class="o">=</span> <span class="n">gm</span><span class="p">[[</span><span class="s1">&#39;Country&#39;</span><span class="p">,</span> <span class="s1">&#39;region&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
<span class="n">df_w_regions</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">co2</span><span class="p">,</span> <span class="n">df_gm</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;country&#39;</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;Country&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;inner&#39;</span><span class="p">)</span>
<span class="n">df_w_regions</span> <span class="o">=</span> <span class="n">df_w_regions</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;Country&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;columns&#39;</span><span class="p">)</span>

<span class="n">new_co2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">df_w_regions</span><span class="p">,</span> <span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;country&#39;</span><span class="p">,</span> <span class="s1">&#39;region&#39;</span><span class="p">])</span>
<span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;country&#39;</span><span class="p">,</span> <span class="s1">&#39;region&#39;</span><span class="p">,</span> <span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="s1">&#39;co2&#39;</span><span class="p">]</span>
<span class="n">new_co2</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">columns</span>
<span class="n">df_co2</span> <span class="o">=</span> <span class="n">new_co2</span><span class="p">[</span><span class="n">new_co2</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;int64&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1963</span><span class="p">]</span>
<span class="n">df_co2</span> <span class="o">=</span> <span class="n">df_co2</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;country&#39;</span><span class="p">,</span> <span class="s1">&#39;year&#39;</span><span class="p">])</span>
<span class="n">df_co2</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_co2</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;int64&#39;</span><span class="p">)</span>

<span class="n">df_gdp</span> <span class="o">=</span> <span class="n">gm</span><span class="p">[[</span><span class="s1">&#39;Country&#39;</span><span class="p">,</span> <span class="s1">&#39;Year&#39;</span><span class="p">,</span> <span class="s1">&#39;fertility&#39;</span><span class="p">,</span> <span class="s1">&#39;life&#39;</span><span class="p">,</span> <span class="s1">&#39;population&#39;</span><span class="p">]]</span>
<span class="n">df_gdp</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;country&#39;</span><span class="p">,</span> <span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="s1">&#39;fertility&#39;</span><span class="p">,</span> <span class="s1">&#39;life&#39;</span><span class="p">,</span> <span class="s1">&#39;population&#39;</span><span class="p">]</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df_co2</span><span class="p">,</span> <span class="n">df_gdp</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;country&#39;</span><span class="p">,</span> <span class="s1">&#39;year&#39;</span><span class="p">],</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>

<span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>country</th>
      <th>region</th>
      <th>year</th>
      <th>co2</th>
      <th>fertility</th>
      <th>life</th>
      <th>population</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Afghanistan</td>
      <td>South Asia</td>
      <td>1964</td>
      <td>0.0863</td>
      <td>7.671</td>
      <td>33.639</td>
      <td>10474903.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Afghanistan</td>
      <td>South Asia</td>
      <td>1965</td>
      <td>0.1010</td>
      <td>7.671</td>
      <td>34.152</td>
      <td>10697983.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Afghanistan</td>
      <td>South Asia</td>
      <td>1966</td>
      <td>0.1080</td>
      <td>7.671</td>
      <td>34.662</td>
      <td>10927724.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Afghanistan</td>
      <td>South Asia</td>
      <td>1967</td>
      <td>0.1240</td>
      <td>7.671</td>
      <td>35.170</td>
      <td>11163656.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Afghanistan</td>
      <td>South Asia</td>
      <td>1968</td>
      <td>0.1160</td>
      <td>7.671</td>
      <td>35.674</td>
      <td>11411022.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Visualicemos la relación entre el co2 y life. El  coeficiente de correlación nos indica que hay una correlación positiva moderada.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np_co2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;co2&#39;</span><span class="p">])</span>
<span class="n">np_life</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;life&#39;</span><span class="p">])</span>
<span class="n">np</span><span class="o">.</span><span class="n">corrcoef</span><span class="p">(</span><span class="n">np_co2</span><span class="p">,</span> <span class="n">np_life</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[1.        , 0.40288934],
       [0.40288934, 1.        ]])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">life</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">life</span><span class="p">)</span>
<span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">co2</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">co2</span><span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> 
                 <span class="n">x</span><span class="o">=</span><span class="s2">&quot;life&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;co2&quot;</span><span class="p">,</span> 
                 <span class="n">animation_frame</span><span class="o">=</span><span class="s2">&quot;year&quot;</span><span class="p">,</span>
                 <span class="n">animation_group</span><span class="o">=</span><span class="s2">&quot;country&quot;</span><span class="p">,</span>
                 <span class="n">color</span><span class="o">=</span><span class="s2">&quot;region&quot;</span><span class="p">,</span>
                 <span class="n">facet_col</span><span class="o">=</span><span class="s2">&quot;region&quot;</span><span class="p">,</span>
                 <span class="n">hover_name</span><span class="o">=</span><span class="s2">&quot;country&quot;</span><span class="p">,</span>
                 <span class="n">size</span><span class="o">=</span><span class="s2">&quot;co2&quot;</span><span class="p">,</span>
                 <span class="n">width</span><span class="o">=</span><span class="mi">1500</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> 
                 <span class="n">log_x</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                 <span class="n">range_x</span><span class="o">=</span><span class="p">[</span><span class="n">xmin</span><span class="p">,</span><span class="n">xmax</span><span class="p">],</span>
                 <span class="n">range_y</span><span class="o">=</span><span class="p">[</span><span class="n">ymin</span><span class="p">,</span><span class="n">ymax</span><span class="p">])</span>
<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
</div>
</div>
<p>Si vemos por ejemplo el año 2013 tenemos que para “East Asia &amp; Pacific” tenemos que las mayores emisiones de co2 se dan cuanto se tiene una esperanza de vida mayor, este mismo coportamiento se aprecia en “America”. Mientras que en “South Asia” no hay gran diferencia entre las emisiones de co2 y la esperanza de vida, se puede decir que son independientes.</p>
<p>Si miramos las emisiones de co2 para “South Asia” a lo largo de los años (1964 - 2013) vemos como las emisiones de co2 se mantienen en el mismo rango.</p>
<p>Al revisar ahora la relación entre co2 y fertility ,tenemos que el hay una correlación negativa moderada según el valor que nos arroja el coeficiente de correlación</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np_fertility</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;fertility&#39;</span><span class="p">])</span>
<span class="n">np</span><span class="o">.</span><span class="n">corrcoef</span><span class="p">(</span><span class="n">np_co2</span><span class="p">,</span> <span class="n">np_fertility</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[ 1.        , -0.31439742],
       [-0.31439742,  1.        ]])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">fertility</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">fertility</span><span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> 
                 <span class="n">x</span><span class="o">=</span><span class="s2">&quot;fertility&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;co2&quot;</span><span class="p">,</span> 
                 <span class="n">animation_frame</span><span class="o">=</span><span class="s2">&quot;year&quot;</span><span class="p">,</span>
                 <span class="n">hover_name</span><span class="o">=</span><span class="s2">&quot;country&quot;</span><span class="p">,</span>
                 <span class="n">color</span><span class="o">=</span><span class="s2">&quot;region&quot;</span><span class="p">,</span>
                 <span class="n">facet_col</span><span class="o">=</span><span class="s2">&quot;region&quot;</span><span class="p">,</span>
                 <span class="n">size</span><span class="o">=</span><span class="s2">&quot;co2&quot;</span><span class="p">,</span>
                 <span class="n">width</span><span class="o">=</span><span class="mi">1400</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> 
                 <span class="n">log_x</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                 <span class="n">range_x</span><span class="o">=</span><span class="p">[</span><span class="n">xmin</span><span class="p">,</span><span class="n">xmax</span><span class="p">],</span>
                 <span class="n">range_y</span><span class="o">=</span><span class="p">[</span><span class="n">ymin</span><span class="p">,</span><span class="n">ymax</span><span class="p">])</span>
<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
</div>
</div>
<p>Si nos enfocamos por ejemplo en el año 2000, vemos que las emisiones de calor más grande se tienen en “Middle East &amp; North Africa”.</p>
<p>Graficamente se nota por ejemplo que en “East Asia &amp; Pacific” y “America” a menos fertilidad mayores emisiones de c02, a lo largo de todos los años analizados</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">fertility</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">fertility</span><span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> 
                 <span class="n">x</span><span class="o">=</span><span class="s2">&quot;fertility&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;co2&quot;</span><span class="p">,</span> 
                 <span class="n">animation_frame</span><span class="o">=</span><span class="s2">&quot;year&quot;</span><span class="p">,</span>
                 <span class="n">hover_name</span><span class="o">=</span><span class="s2">&quot;country&quot;</span><span class="p">,</span>
                 <span class="n">color</span><span class="o">=</span><span class="s2">&quot;region&quot;</span><span class="p">,</span>
                 <span class="n">size</span><span class="o">=</span><span class="s2">&quot;co2&quot;</span><span class="p">,</span>
                 <span class="n">width</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> 
                 <span class="n">log_x</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                 <span class="n">range_x</span><span class="o">=</span><span class="p">[</span><span class="n">xmin</span><span class="p">,</span><span class="n">xmax</span><span class="p">],</span>
                 <span class="n">range_y</span><span class="o">=</span><span class="p">[</span><span class="n">ymin</span><span class="p">,</span><span class="n">ymax</span><span class="p">])</span>
<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
</div>
</div>
<p>Al comparar las emisiones de c02 entre las regiones vemos que “Middle East &amp; North Africa” a lo largo de los años ha tenido las mayores emisiones.</p>
</div>
<div class="section" id="ejercicio-2-4">
<h2>Ejercicio 2.4<a class="headerlink" href="#ejercicio-2-4" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>La primera tarea es poner a funcionar todo lo realizado en esta sección y entenderlo. Luego de esto creará una nueva tabla que llamaremos <code class="docutils literal notranslate"><span class="pre">links</span></code>, la cual contendrá información acerca de link de páginas web. La tabla debe ser creada siguiendo las siguientes instrucciones. En la siguiente revisaremos con detalle el significado de cada consulta <code class="docutils literal notranslate"><span class="pre">SQL</span></code></p></li>
</ul>
<div class="highlight-mysql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">links</span> <span class="p">(</span>
	<span class="n">id</span> <span class="kt">SERIAL</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
	<span class="n">url</span> <span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">NOT</span> <span class="no">NULL</span><span class="p">,</span>
	<span class="k">name</span> <span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">NOT</span> <span class="no">NULL</span><span class="p">,</span>
	<span class="k">description</span> <span class="kt">VARCHAR</span> <span class="p">(</span><span class="mi">255</span><span class="p">),</span>
    <span class="n">last_update</span> <span class="kt">DATE</span>
<span class="p">);</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Luego insertará datos a la tabla usando las siguientes ordenes. En cada caso debe mostrar el output generado por <strong>pgAdmin</strong>, así como también la actualización de <strong>Heroku Postgres</strong></p></li>
</ul>
<div class="highlight-mysql notranslate"><div class="highlight"><pre><span></span><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">links</span> <span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="k">name</span><span class="p">)</span>
<span class="k">VALUES</span><span class="p">(</span><span class="s1">&#39;https://www.postgresqltutorial.com&#39;</span><span class="p">,</span><span class="s1">&#39;PostgreSQL Tutorial&#39;</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-mysql notranslate"><div class="highlight"><pre><span></span><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">links</span> <span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="k">name</span><span class="p">)</span>
<span class="k">VALUES</span><span class="p">(</span><span class="s1">&#39;http://www.oreilly.com&#39;</span><span class="p">,</span><span class="s1">&#39;O</span><span class="se">&#39;&#39;</span><span class="s1">Reilly Media&#39;</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-mysql notranslate"><div class="highlight"><pre><span></span><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">links</span> <span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="k">name</span><span class="p">)</span>
<span class="k">VALUES</span><span class="p">(</span><span class="s1">&#39;http://www.oreilly.com&#39;</span><span class="p">,</span><span class="s1">&#39;O</span><span class="se">&#39;&#39;</span><span class="s1">Reilly Media&#39;</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-mysql notranslate"><div class="highlight"><pre><span></span><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">links</span> <span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="k">name</span><span class="p">,</span> <span class="n">last_update</span><span class="p">)</span>
<span class="k">VALUES</span><span class="p">(</span><span class="s1">&#39;https://www.google.com&#39;</span><span class="p">,</span><span class="s1">&#39;Google&#39;</span><span class="p">,</span><span class="s1">&#39;2013-06-01&#39;</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-mysql notranslate"><div class="highlight"><pre><span></span><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">links</span> <span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="k">name</span><span class="p">)</span>
<span class="k">VALUES</span><span class="p">(</span><span class="s1">&#39;http://www.postgresql.org&#39;</span><span class="p">,</span><span class="s1">&#39;PostgreSQL&#39;</span><span class="p">)</span> 
<span class="k">RETURNING</span> <span class="n">id</span><span class="p">;</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Importe los datos del precio de <strong>Cardano USD (ADA-USD)</strong> en su base de datos <strong>Herokus Postgres</strong>, teniendo en cuenta lo explicado. Luego dibuje un gráfico de candlestick para la criptomoneda. En el siguiente link encontrará el <strong>CSV</strong> de <strong>Cardano</strong>: <a class="reference external" href="https://raw.githubusercontent.com/lihkir/Uninorte/main/AppliedStatisticMS/DataVisualizationRPython/Lectures/Python/PythonDataSets/ADA-USD.csv">Cardano USD (ADA-USD)</a></p></li>
</ul>
<p>Primero creamos conexión con nuestra base de datos PostgresSql que se encuentra en Heroku.</p>
<p><img alt="" src="_images/0tablas.png" />
<img alt="" src="_images/0estadoheroku.png" /></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">connection</span> <span class="o">=</span> <span class="n">psycopg2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="s2">&quot;uqtxfaqjjcxggw&quot;</span><span class="p">,</span>
                                  <span class="n">password</span><span class="o">=</span><span class="s2">&quot;916d311356954de6a99118d13578bb9d1b47bdc86cb8360a60b9606293bd882d&quot;</span><span class="p">,</span>
                                  <span class="n">host</span><span class="o">=</span><span class="s2">&quot;ec2-3-229-43-149.compute-1.amazonaws.com&quot;</span><span class="p">,</span>
                                  <span class="n">port</span><span class="o">=</span><span class="s2">&quot;5432&quot;</span><span class="p">,</span>
                                  <span class="n">database</span><span class="o">=</span><span class="s2">&quot;d41lsl8qgestjf&quot;</span><span class="p">)</span>
<span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Procedemos a crear una nueva tabla como sigue:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;DROP TABLE IF EXISTS links&#39;&#39;&#39;</span><span class="p">)</span>
<span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;CREATE TABLE links(</span>
<span class="s1">id SERIAL PRIMARY KEY NOT NULL,</span>
<span class="s1">url VARCHAR(255) NOT NULL,</span>
<span class="s1">name VARCHAR(255) NOT NULL,</span>
<span class="s1">description VARCHAR (255),</span>
<span class="s1">last_update DATE);</span>
<span class="s1">&#39;&#39;&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Table created successfully&quot;</span><span class="p">)</span>
   
<span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Table created successfully
</pre></div>
</div>
</div>
</div>
<p><img alt="" src="_images/1create_links.png" />
<img alt="" src="_images/1estadoheroku.png" /></p>
<p>Ahora, insertaremos registros en la tabla:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;INSERT INTO links (url, name) VALUES (&#39;https://www.postgresqltutorial.com&#39;,&#39;PostgreSQL Tutorial&#39;)&quot;</span><span class="p">);</span>

<span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;INSERT INTO links (url, name) VALUES (&#39;http://www.oreilly.com&#39;,&#39;O&#39;&#39;Reilly Media&#39;)&quot;</span><span class="p">);</span>

<span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;INSERT INTO links (url, name) VALUES (&#39;http://www.oreilly.com&#39;,&#39;O&#39;&#39;Reilly Media&#39;)&quot;</span><span class="p">);</span>

<span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;INSERT INTO links (url, name,last_update) VALUES (&#39;https://www.google.com&#39;,&#39;Google&#39;,&#39;2013-06-01&#39;)&quot;</span><span class="p">);</span>

<span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;INSERT INTO links (url, name) VALUES (&#39;http://www.postgresql.org&#39;,&#39;PostgreSQL&#39;)&quot;</span><span class="p">);</span>

<span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Records created successfully&quot;</span><span class="p">)</span>
<span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Records created successfully
</pre></div>
</div>
</div>
</div>
<p><img alt="" src="_images/2insertlinks.png" />
<img alt="" src="_images/2estadoheroku.png" /></p>
<p>Importamos los datos del precio de Cardano USD (ADA-USD)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_cardano</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;https://raw.githubusercontent.com/lihkir/Uninorte/main/AppliedStatisticMS/DataVisualizationRPython/Lectures/Python/PythonDataSets/ADA-USD.csv&quot;</span><span class="p">)</span>
<span class="n">df_cardano</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Date</th>
      <th>Open</th>
      <th>High</th>
      <th>Low</th>
      <th>Close</th>
      <th>Adj Close</th>
      <th>Volume</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2017-10-01</td>
      <td>0.021678</td>
      <td>0.032226</td>
      <td>0.017354</td>
      <td>0.024969</td>
      <td>0.024969</td>
      <td>50068700.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2017-10-02</td>
      <td>0.024607</td>
      <td>0.030088</td>
      <td>0.019969</td>
      <td>0.025932</td>
      <td>0.025932</td>
      <td>57641300.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2017-10-03</td>
      <td>0.025757</td>
      <td>0.027425</td>
      <td>0.020690</td>
      <td>0.020816</td>
      <td>0.020816</td>
      <td>16997800.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2017-10-04</td>
      <td>0.020864</td>
      <td>0.022806</td>
      <td>0.020864</td>
      <td>0.021931</td>
      <td>0.021931</td>
      <td>9000050.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2017-10-05</td>
      <td>0.021951</td>
      <td>0.022154</td>
      <td>0.020859</td>
      <td>0.021489</td>
      <td>0.021489</td>
      <td>5562510.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Cargamos el dataset en nuestra base  de  datos en Heroku</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s1">&#39;postgresql://uqtxfaqjjcxggw:916d311356954de6a99118d13578bb9d1b47bdc86cb8360a60b9606293bd882d@ec2-3-229-43-149.compute-1.amazonaws.com:5432/d41lsl8qgestjf&#39;</span><span class="p">)</span>
<span class="n">df_cardano</span><span class="o">.</span><span class="n">to_sql</span><span class="p">(</span><span class="s1">&#39;cardano&#39;</span><span class="p">,</span> <span class="n">engine</span><span class="p">,</span> <span class="n">if_exists</span> <span class="o">=</span> <span class="s1">&#39;replace&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;multi&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><img alt="" src="_images/3insertcardano.png" />
<img alt="" src="_images/3estadoheroku.png" /></p>
<p>Leemos los datos desde nuestra tabla “cardano” de la base de datos</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">connection</span> <span class="o">=</span> <span class="n">psycopg2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="s2">&quot;uqtxfaqjjcxggw&quot;</span><span class="p">,</span>
                                  <span class="n">password</span><span class="o">=</span><span class="s2">&quot;916d311356954de6a99118d13578bb9d1b47bdc86cb8360a60b9606293bd882d&quot;</span><span class="p">,</span>
                                  <span class="n">host</span><span class="o">=</span><span class="s2">&quot;ec2-3-229-43-149.compute-1.amazonaws.com&quot;</span><span class="p">,</span>
                                  <span class="n">port</span><span class="o">=</span><span class="s2">&quot;5432&quot;</span><span class="p">,</span>
                                  <span class="n">database</span><span class="o">=</span><span class="s2">&quot;d41lsl8qgestjf&quot;</span><span class="p">)</span>

<span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT * from cardano;&quot;</span><span class="p">)</span>
<span class="n">close</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
<span class="n">cardano_sql</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">close</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">cardano_sql</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2017-10-01</td>
      <td>0.021678</td>
      <td>0.032226</td>
      <td>0.017354</td>
      <td>0.024969</td>
      <td>0.024969</td>
      <td>50068700.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2017-10-02</td>
      <td>0.024607</td>
      <td>0.030088</td>
      <td>0.019969</td>
      <td>0.025932</td>
      <td>0.025932</td>
      <td>57641300.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2017-10-03</td>
      <td>0.025757</td>
      <td>0.027425</td>
      <td>0.020690</td>
      <td>0.020816</td>
      <td>0.020816</td>
      <td>16997800.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2017-10-04</td>
      <td>0.020864</td>
      <td>0.022806</td>
      <td>0.020864</td>
      <td>0.021931</td>
      <td>0.021931</td>
      <td>9000050.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2017-10-05</td>
      <td>0.021951</td>
      <td>0.022154</td>
      <td>0.020859</td>
      <td>0.021489</td>
      <td>0.021489</td>
      <td>5562510.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Vemos que nuestro dataframe no tiene los nombres de las columnas, entonces procedemos a ajustarlo de acuerdo a los nombres de las columnas en nuestra tabla dentro de la base  de  datos.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT column_name FROM information_schema.columns WHERE table_name=&#39;cardano&#39;;&quot;</span><span class="p">)</span>
<span class="n">names</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Operation done successfully&quot;</span><span class="p">)</span>
<span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="n">names_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">]</span>
<span class="n">cardano_sql</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">names_list</span> 
<span class="n">cardano_sql</span> <span class="o">=</span> <span class="n">cardano_sql</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span> <span class="o">=</span> <span class="s2">&quot;Date&quot;</span><span class="p">)</span>
<span class="n">cardano_sql</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Operation done successfully
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Date</th>
      <th>Open</th>
      <th>High</th>
      <th>Low</th>
      <th>Close</th>
      <th>Adj Close</th>
      <th>Volume</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2017-10-01</td>
      <td>0.021678</td>
      <td>0.032226</td>
      <td>0.017354</td>
      <td>0.024969</td>
      <td>0.024969</td>
      <td>50068700.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2017-10-02</td>
      <td>0.024607</td>
      <td>0.030088</td>
      <td>0.019969</td>
      <td>0.025932</td>
      <td>0.025932</td>
      <td>57641300.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2017-10-03</td>
      <td>0.025757</td>
      <td>0.027425</td>
      <td>0.020690</td>
      <td>0.020816</td>
      <td>0.020816</td>
      <td>16997800.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2017-10-04</td>
      <td>0.020864</td>
      <td>0.022806</td>
      <td>0.020864</td>
      <td>0.021931</td>
      <td>0.021931</td>
      <td>9000050.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2017-10-05</td>
      <td>0.021951</td>
      <td>0.022154</td>
      <td>0.020859</td>
      <td>0.021489</td>
      <td>0.021489</td>
      <td>5562510.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Por último realizamos el candlestick para la criptomoneda</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">go</span><span class="o">.</span><span class="n">Candlestick</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">cardano_sql</span><span class="o">.</span><span class="n">Date</span><span class="p">,</span>
                                     <span class="nb">open</span> <span class="o">=</span> <span class="n">cardano_sql</span><span class="o">.</span><span class="n">Open</span><span class="p">,</span> 
                                     <span class="n">high</span> <span class="o">=</span> <span class="n">cardano_sql</span><span class="o">.</span><span class="n">High</span><span class="p">,</span>
                                     <span class="n">low</span> <span class="o">=</span> <span class="n">cardano_sql</span><span class="o">.</span><span class="n">Low</span><span class="p">,</span> 
                                     <span class="n">close</span> <span class="o">=</span> <span class="n">cardano_sql</span><span class="o">.</span><span class="n">Close</span><span class="p">)</span>
                     <span class="p">])</span>
<span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Cardano USD (ADA-USD)&quot;</span><span class="p">,</span>
    <span class="n">xaxis_title</span><span class="o">=</span><span class="s2">&quot;Day&quot;</span><span class="p">,</span>
    <span class="n">yaxis_title</span><span class="o">=</span><span class="s2">&quot;ADA-USD&quot;</span><span class="p">,</span>
    <span class="n">font</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
        <span class="n">family</span><span class="o">=</span><span class="s2">&quot;Courier New, monospace&quot;</span><span class="p">,</span>
        <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;RebeccaPurple&quot;</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">xaxis_rangeslider_visible</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
</div>
</div>
<p>Vemos como por ejemplo, los precios de Cardano, tuvieron una caída luego de enero de 2018 y su precio se mantuvo muy cercano a los 0.03 USD hasta julio de 2020 donde empezó a subir su precio, logrando alcanzar casi los 3 USD para septiembre de 2021. Actualmente el precio de Cardano se encuentra a la baja con valroes al rededor de los 2.5 USD.</p>
<p>Ahora si nos enfocamos en el mes de agosto de 2021, vemos que es mayor el volumen de compras (velas verdes) que las ventas (velas rojas).</p>
<p>Si revisamos el último registro que tenemos, vemos que para el 14 de Octubre de 2021, el precio de Cardano abrió en 2.195 USD y cerró 2.179 USD, con valores mínimo y maximo de 2.162 y 2.221, respectivamente.</p>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
            <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="Taller1_Python_JA_AP.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Taller 1. Visualización de Datos en Python y R.</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="EDA_Acciones_COL.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Análisis Exploratorio de Datos - Proyecto Final Python</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
        
        </div>
    </div>
    <footer class="footer">
    <div class="container">
      <p>
        
          By Jorge Arteaga y Adriana Palacio<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>